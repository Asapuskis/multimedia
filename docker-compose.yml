---
services:
  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID=${UID}
      - PGID=${UID}
      - TZ=${TIMEZONE}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG_DIR}/sonarr-config:/config
      - ${DATA_DIR}:/data
      - ./scripts:/scripts:ro
    ports:
      - "8989:8989"
    networks:
      - monitorizacion
    labels:
      - traefik.enable=true
      - traefik.http.routers.sonarr-http.rule=Host(`sonarr.${INTERNAL_DOMAIN}`)
      - traefik.http.routers.sonarr-http.entrypoints=web
      - traefik.http.routers.sonarr-http.service=sonarr
      - traefik.http.services.sonarr.loadbalancer.server.port=8989
    restart: unless-stopped

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID=${UID}
      - PGID=${UID}
      - TZ=${TIMEZONE}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG_DIR}/radarr-config:/config
      - ${DATA_DIR}:/data
      - ./scripts:/scripts:ro
    ports:
      - "7878:7878"
    networks:
      - monitorizacion
    labels:
      - traefik.enable=true
      - traefik.http.routers.radarr-http.rule=Host(`radarr.${INTERNAL_DOMAIN}`)
      - traefik.http.routers.radarr-http.entrypoints=web
      - traefik.http.routers.radarr-http.service=radarr
      - traefik.http.services.radarr.loadbalancer.server.port=7878
    restart: unless-stopped

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    environment:
      - PUID=${UID}
      - PGID=${UID}
      - TZ=${TIMEZONE}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG_DIR}/bazarr-config:/config
      - ${DATA_DIR}:/data
    ports:
      - "6767:6767"
    networks:
      - monitorizacion
    labels:
      - traefik.enable=true
      - traefik.http.routers.bazarr-http.rule=Host(`bazarr.${INTERNAL_DOMAIN}`)
      - traefik.http.routers.bazarr-http.entrypoints=web
      - traefik.http.routers.bazarr-http.service=bazarr
      - traefik.http.services.bazarr.loadbalancer.server.port=6767
    restart: unless-stopped

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:develop
    container_name: prowlarr
    environment:
      - PUID=${UID}
      - PGID=${UID}
      - TZ=${TIMEZONE}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${CONFIG_DIR}/prowlarr-config:/config
      - ${DATA_DIR}:/data
    ports:
      - "9696:9696"
    networks:
      - monitorizacion
    labels:
      - traefik.enable=true
      - traefik.http.routers.prowlarr-http.rule=Host(`prowlarr.${INTERNAL_DOMAIN}`)
      - traefik.http.routers.prowlarr-http.entrypoints=web
      - traefik.http.routers.prowlarr-http.service=prowlarr
      - traefik.http.services.prowlarr.loadbalancer.server.port=9696
    restart: unless-stopped

  profilarr:
    image: santiagosayshey/profilarr:latest
    container_name: profilarr
    ports:
        - 6868:6868
    volumes:
        - ${CONFIG_DIR}/profilarr-config:/config
    environment:
        - TZ=${TIMEZONE}
    networks:
      - monitorizacion
    labels:
      - traefik.enable=true
      - traefik.http.routers.profilarr-http.rule=Host(`profilarr.${INTERNAL_DOMAIN}`)
      - traefik.http.routers.profilarr-http.entrypoints=web
      - traefik.http.routers.profilarr-http.service=profilarr
      - traefik.http.services.profilarr.loadbalancer.server.port=6868
    restart: unless-stopped

  qbittorrent:
    image: qbittorrentofficial/qbittorrent-nox:latest
    container_name: qbittorrent
    environment:
      - PUID=${UID}
      - PGID=${UID}
      - TZ=${TIMEZONE}
      - WEBUI_PORT=8080
    volumes:
      - ${CONFIG_DIR}/qbittorrent-config:/config
      - ${DATA_DIR}/torrents/:/data/torrents/
    ports:
      - "8080:8080"
      - "6881:6881"
      - "6881:6881/udp"
    networks:
      - monitorizacion
    labels:
      - traefik.enable=true
      - traefik.http.routers.qbittorrent-http.rule=Host(`qbittorrent.${INTERNAL_DOMAIN}`)
      - traefik.http.routers.qbittorrent-http.entrypoints=web
      - traefik.http.routers.qbittorrent-http.service=qbittorrent
      - traefik.http.services.qbittorrent.loadbalancer.server.port=8080
    restart: unless-stopped

  qbit_manage:
    container_name: qbit_manage
    image: ghcr.io/stuffanthings/qbit_manage:latest
    volumes:
      - ${CONFIG_DIR}/qbitmanage-config/:/config:rw
      - ${DATA_DIR}/torrents/:/data/torrents:rw
      - ${DATA_DIR}/media/:/data/media:rw
      - /mnt/user/appdata/qbittorrent/:/qbittorrent/:ro
    environment:
      - QBIT_USER=${QBIT_USER}
      - QBIT_PASS=${QBIT_PASS}
      - QBT_RUN=false
      - QBT_SCHEDULE=1440
      - QBT_CONFIG=config.yml
      - QBT_LOGFILE=activity.log
      - QBT_CROSS_SEED=false
      - QBT_RECHECK=false
      - QBT_CAT_UPDATE=false
      - QBT_TAG_UPDATE=false
      - QBT_REM_UNREGISTERED=true
      - QBT_REM_ORPHANED=true
      - QBT_TAG_TRACKER_ERROR=false
      - QBT_TAG_NOHARDLINKS=true
      - QBT_SHARE_LIMITS=false
      - QBT_SKIP_CLEANUP=false
      - QBT_DRY_RUN=false
      - QBT_LOG_LEVEL=INFO
      - QBT_DIVIDER==
      - QBT_WIDTH=100
    restart: on-failure:2

  cleanuparr:
    image: ghcr.io/cleanuparr/cleanuparr:latest
    container_name: cleanuparr
    restart: unless-stopped
    ports:
      - "11011:11011"
    volumes:
      - ${CONFIG_DIR}/cleanuparr-config:/config
      # Mount your downloads directory if needed
      - ${DATA_DIR}/media:/downloads
    environment:
      - PORT=11011
      - BASE_PATH=
      - PUID=1000
      - PGID=1000
      - UMASK=022
      - TZ=Etc/UTC
    networks:
      - monitorizacion
    labels:
      - traefik.enable=true
      - traefik.http.routers.cleanuparr-http.rule=Host(`cleanuparr.${INTERNAL_DOMAIN}`)
      - traefik.http.routers.cleanuparr-http.entrypoints=web
      - traefik.http.routers.cleanuparr-http.service=cleanuparr
      - traefik.http.services.cleanuparr.loadbalancer.server.port=11011
    # Health check configuration
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:11011/health"]
      interval: 30s        # Check every 30 seconds
      timeout: 10s         # Allow up to 10 seconds for response
      start_period: 30s    # Wait 30 seconds before first check
      retries: 3           # Mark unhealthy after 3 consecutive failures

  jellyseerr:
    image: fallenbagel/jellyseerr:latest
    container_name: jellyseerr
    environment:
      - LOG_LEVEL=debug
      - TZ=${TIMEZONE}
      - JELLYFIN_TYPE=emby
    volumes:
      - ${CONFIG_DIR}/jellyseerr-config:/app/config
    ports:
      - "5055:5055"
    dns:
      - 8.8.8.8
    networks:
      - monitorizacion
    labels:
      - traefik.enable=true
      - traefik.http.routers.jellyseerr-http.rule=Host(`jellyseerr.${INTERNAL_DOMAIN}`)
      - traefik.http.routers.jellyseerr-http.entrypoints=web
      - traefik.http.routers.jellyseerr-http.service=jellyseerr
      - traefik.http.services.jellyseerr.loadbalancer.server.port=5055
    restart: unless-stopped

  emby:
    image: emby/embyserver_arm64v8
    container_name: embyserver
    environment:
      - UID=${UID}
      - GID=${UID}
    volumes:
      - ${CONFIG_DIR}/emby-config:/config
      - ${DATA_DIR}/media/:/data/media/
    ports:
      - 8097:8096  # Puerto HTTP de Emby
      - 8921:8920  # Puerto HTTPS de Emby (opcional)
    networks:
      - monitorizacion
    labels:
      - traefik.enable=true
      - traefik.http.routers.emby-http.rule=Host(`emby.${INTERNAL_DOMAIN}`)
      - traefik.http.routers.emby-http.entrypoints=web
      - traefik.http.routers.emby-http.service=emby
      - traefik.http.services.emby.loadbalancer.server.port=8096
    restart: unless-stopped

networks:
  monitorizacion:
    external: true
